# 导航网站项目

## 项目介绍

这是一个基于飞书多维表格数据的导航网站，通过调用飞书API获取表格数据，生成一个美观且功能丰富的导航页面。网站具有现代化的UI设计，支持多种设备访问，并提供个性化的用户体验。

## 功能特点

### 核心功能
- **数据源管理**：从飞书多维表格获取导航数据，支持API失败时的模拟数据降级
- **分类展示**：按分类展示导航链接，支持动态分类菜单生成
- **智能图标**：自动获取网站favicon，失败时生成文字图标作为备用
- **数据缓存**：5分钟数据缓存机制，减少API调用频率

### 用户体验
- **响应式设计**：完美适配桌面端和移动端，移动端专门优化
- **实时时间**：显示当前时间、日期和农历信息
- **暗黑模式**：支持自动跟随系统偏好或手动切换，本地存储用户偏好
- **移动端搜索**：全功能搜索界面，支持关键词搜索和热门建议
- **触摸手势**：移动端支持左右滑动切换分类，触摸反馈

### 移动端特性
- **汉堡菜单**：移动端侧边栏菜单，支持手势操作
- **搜索功能**：专门的移动端搜索界面，支持实时搜索和结果高亮
- **触摸优化**：涟漪效果、震动反馈（如设备支持）
- **手势导航**：左右滑动切换分类

### 技术特性
- **错误处理**：完善的错误处理机制和用户友好的错误提示
- **性能监控**：内置页面加载性能监控
- **农历支持**：使用lunar-javascript库显示农历日期和节气
- **Token缓存**：飞书API token自动缓存和刷新机制

## 技术栈

### 后端技术
- **Node.js + Express**：服务器框架
- **axios**：HTTP客户端，用于调用飞书API
- **dotenv**：环境变量管理
- **moment**：时间处理库，支持中文本地化
- **lunar-javascript**：农历转换库，显示农历日期和节气
- **serverless-http**：Serverless部署支持

### 前端技术
- **原生JavaScript**：无框架依赖，轻量高效
- **CSS3**：现代CSS特性，支持CSS变量和动画
- **Bootstrap Icons**：图标库
- **响应式设计**：移动端优先的设计理念

### API集成
- **飞书开放平台API**：多维表格数据获取
- **Google Favicon API**：自动获取网站图标

### 部署支持
- **Vercel**：已配置vercel.json，支持一键部署
- **本地开发**：支持nodemon热重载开发模式

## 项目结构

```
├── public/                          # 静态资源目录
│   ├── css/
│   │   └── style.css               # 主样式文件，包含响应式设计和暗黑模式
│   ├── js/
│   │   └── app.js                  # 前端主逻辑，包含搜索、主题切换、手势支持
│   ├── img/
│   │   └── avatar.svg              # 用户头像图标
│   └── index.html                  # 主页面，响应式布局
├── doc/                            # 文档目录
├── specs/                          # 规格说明
├── .env                            # 环境变量配置（不应提交到版本控制）
├── .env.example                    # 环境变量示例
├── .gitignore                      # Git忽略文件配置
├── package.json                    # 项目依赖配置
├── server.js                       # 服务器入口文件，包含飞书API集成
├── vercel.json                     # Vercel部署配置
└── README.md                       # 项目说明文档
```

## 安装与使用

### 前置条件

- Node.js 14.0 或更高版本
- 飞书开发者账号和已创建的自建应用
- 飞书多维表格（包含导航数据）

### 安装步骤

1. 克隆或下载项目代码

2. 安装依赖
   ```
   npm install
   ```

3. 配置环境变量
   - 复制 `.env.example` 为 `.env`
   - 填入你的飞书应用 ID、Secret 和多维表格信息

4. 启动服务
   ```
   npm start
   ```

5. 访问网站
   - 打开浏览器，访问 `http://localhost:3000`

## 飞书多维表格配置

多维表格需要包含以下字段：

- **站点名称/name**：导航项的名称
- **网址/url**：导航项的链接地址（支持对象格式 `{link: "url"}` 或字符串格式）
- **分类/category**：导航项的分类（如：Code、设计、产品等）
- **排序/sort**：导航项在分类中的排序（数字越小越靠前）
- **图标/icon**：导航项的图标（可选，支持Bootstrap图标类名或图片URL）

### 数据降级机制
当飞书API不可用时，系统会自动使用内置的模拟数据，确保网站正常运行。

## 移动端功能

### 响应式设计
- **断点设计**：768px以下为移动端，768px以上为桌面端
- **移动端导航**：汉堡菜单 + 侧边栏设计
- **触摸优化**：按钮大小、间距针对触摸操作优化

### 搜索功能
- **全屏搜索界面**：移动端专门的搜索体验
- **实时搜索**：输入时实时显示搜索结果
- **搜索建议**：热门搜索关键词推荐
- **结果高亮**：搜索关键词在结果中高亮显示
- **快速清除**：一键清除搜索内容

### 手势支持
- **左右滑动**：在主内容区域左右滑动切换分类
- **触摸反馈**：支持震动反馈（如设备支持）
- **涟漪效果**：触摸时的视觉反馈效果

## 暗黑模式功能

本项目支持暗黑模式，具有以下特性：

- **自动检测系统偏好**：网站会自动检测用户的系统主题偏好并应用相应的主题
- **手动切换**：用户可以通过侧边栏的切换按钮手动切换亮色/暗黑模式
- **偏好记忆**：用户的主题选择会被保存在本地存储中，下次访问时自动应用
- **平滑过渡**：主题切换时具有平滑的过渡动画效果

## 部署说明

### Vercel 部署
项目已配置 `vercel.json`，支持一键部署到 Vercel：

1. 将代码推送到 GitHub
2. 在 Vercel 中导入项目
3. 配置环境变量（APP_ID、APP_SECRET、APP_TOKEN、TABLE_ID）
4. 部署完成

### 环境变量配置
```bash
APP_ID=your_feishu_app_id
APP_SECRET=your_feishu_app_secret
APP_TOKEN=your_bitable_app_token
TABLE_ID=your_table_id
PORT=3000
```

## 开发说明

### 本地开发
```bash
# 开发模式（支持热重载）
npm run dev

# 生产模式
npm start
```

### 代码结构
- **server.js**：后端服务，包含飞书API集成、token缓存、错误处理
- **public/js/app.js**：前端核心逻辑，包含数据获取、搜索、主题切换、手势支持
- **public/css/style.css**：样式文件，使用CSS变量实现主题切换

### 自定义开发

#### 样式自定义
修改 `public/css/style.css` 中的CSS变量：
```css
:root {
  --primary-color: #1677ff;
  --background-color: #ffffff;
  /* 更多变量... */
}

[data-theme="dark"] {
  --background-color: #141414;
  /* 暗黑模式变量... */
}
```

#### 功能扩展
- **添加新分类**：在飞书表格中添加新的分类数据
- **自定义图标**：支持Bootstrap图标类名或自定义图片URL
- **搜索优化**：可在 `performSearch` 函数中添加更复杂的搜索逻辑

### 性能优化
- **数据缓存**：前端5分钟缓存，后端token自动缓存
- **图标降级**：favicon获取失败时自动生成文字图标
- **错误处理**：完善的错误处理和用户提示机制

## 故障排除

### 常见问题

1. **飞书API连接失败**
   - 检查环境变量配置是否正确
   - 确认飞书应用权限设置
   - 查看控制台错误信息

2. **移动端搜索无法打开**
   - 检查浏览器控制台是否有JavaScript错误
   - 确认所有DOM元素正确加载

3. **图标显示异常**
   - 网站favicon获取失败时会自动显示文字图标
   - 可在飞书表格中手动设置图标字段

4. **暗黑模式不生效**
   - 清除浏览器缓存和本地存储
   - 检查CSS变量是否正确定义

### 调试模式
开启浏览器开发者工具，查看控制台输出的调试信息：
- 数据获取状态
- 缓存使用情况
- 性能监控数据
- 错误详细信息

## 更新日志

### v1.0.0 (当前版本)
- ✅ 基础导航功能
- ✅ 飞书多维表格集成
- ✅ 响应式设计
- ✅ 暗黑模式支持
- ✅ 移动端搜索功能
- ✅ 触摸手势支持
- ✅ 农历日期显示
- ✅ 数据缓存机制
- ✅ Vercel部署支持

### 计划功能
- 🔄 背景图片设置和随机切换
- 🔄 更多主题选项
- 🔄 数据导入导出功能
- 🔄 用户自定义分类

## 贡献指南

欢迎提交Issue和Pull Request来改进这个项目！

### 开发流程
1. Fork 项目
2. 创建功能分支 (`git checkout -b feature/AmazingFeature`)
3. 提交更改 (`git commit -m 'Add some AmazingFeature'`)
4. 推送到分支 (`git push origin feature/AmazingFeature`)
5. 创建 Pull Request

### 代码规范
- 使用2空格缩进
- 遵循现有的代码风格
- 添加必要的注释
- 确保移动端兼容性

## 许可证

MIT License - 详见 [LICENSE](LICENSE) 文件

## 联系方式

如有问题或建议，请通过以下方式联系：
- 提交 GitHub Issue
- 发送邮件至项目维护者

---

**感谢使用导航网站项目！** 🚀
